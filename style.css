/* =========================================
   1. GLOBAL RESET & APP STRUCTURE
   ========================================= */
html, body {
    height: 100%;
    overflow: hidden; /* Handle scrolling in .main-content */
    font-family: 'Inter', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

:root {
    --tw-shadow: 0 0 #0000 !important;
    --tw-shadow-colored: 0 0 #0000 !important;
    
    /* Core EcoCampus Tokens (Preserved) */
    --radius: 24px;
    --gold: #D4AF37;
    --silver: #C0C0C0;
    --bronze: #CD7F32;
    --forest-accent: #1e8f4b;
    --emerald-500: #10B981;
    --emerald-600: #059669;
}

*, *::before, *::after {
    box-shadow: none !important;
}
* {
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

/* --- RESPONSIVE LAYOUT CONTAINER --- */
.app-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column; /* Mobile Default */
    position: relative;
    overflow: hidden;
    background-color: #F8FAFC;
    background-image: radial-gradient(#E2E8F0 1px, transparent 1px);
    background-size: 24px 24px;
}
.dark .app-container {
    background-color: #020617;
    background-image: radial-gradient(#1E293B 1px, transparent 1px);
}

/* Desktop Layout */
@media (min-width: 1024px) {
    .app-container {
        flex-direction: row; 
    }
    #sidebar-toggle-btn { display: none !important; }
}

header, nav {
    flex-shrink: 0;
}

.main-content {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;
    position: relative;
    padding-bottom: 100px; /* Mobile Safe Area */
    width: 100%;
    transition: background-color 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: background-color;
}

@media (min-width: 1024px) {
    .main-content {
        padding-bottom: 20px; 
        max-width: 1200px; 
        margin: 0 auto;
    }
}

/* =========================================
   2. NEW YEAR CELEBRATION LAYER (NEW)
   ========================================= */

/* Fireworks Canvas - Full Screen Overlay */
#fireworks-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none; /* Let clicks pass through */
    z-index: 9999; /* Very high z-index for celebration */
}

/* Countdown Widget - Glassmorphism */
#new-year-widget {
    background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
    box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

#new-year-widget:active {
    transform: scale(0.98);
}

/* New Year Modal Animation */
@keyframes popIn {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

#new-year-modal.visible .bg-white {
    animation: popIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

/* =========================================
   3. ANIMATIONS & CORE UI
   ========================================= */
@keyframes slideInRight {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
}

.page { 
    display: none; 
    animation: slideInRight 0.25s ease-out; 
    will-change: transform, opacity;
}
.page.active { display: block; }

@keyframes pulse-logo {
    0%, 100% { transform: scale(1); opacity: 1; filter: drop-shadow(0 0 10px rgba(16, 185, 129, 0.3)); }
    50% { transform: scale(1.05); opacity: 0.9; filter: drop-shadow(0 0 15px rgba(16, 185, 129, 0.5)); }
}
.app-loader-logo {
    animation: pulse-logo 2.5s infinite ease-in-out;
}

@keyframes pulse-points {
    0% { transform: scale(1); color: var(--emerald-500); }
    50% { transform: scale(1.2); color: var(--emerald-600); }
    100% { transform: scale(1); color: var(--emerald-500); }
}
.points-pulse {
    animation: pulse-points 0.4s ease-out;
}

/* =========================================
   4. SIDEBAR & NAVIGATION
   ========================================= */
#sidebar {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    -ms-overflow-style: none;
    scrollbar-width: none;
    z-index: 50;
    width: 280px; 
    height: 100%;
}
#sidebar::-webkit-scrollbar { display: none; }

#sidebar-overlay { 
    transition: opacity 0.3s ease-in-out; 
    backdrop-filter: blur(2px);
}

@media (min-width: 1024px) {
    #sidebar {
        transform: translateX(0) !important; 
        position: relative; 
        box-shadow: none;
        border-right: 1px solid rgba(0,0,0,0.05);
        background: transparent;
    }
    .dark #sidebar {
        border-right: 1px solid rgba(255,255,255,0.05);
    }
    #sidebar-overlay { display: none !important; }
}

/* Active Nav Items - Green Theme */
.sidebar-nav-item.active {
    background-color: #ECFDF5; /* Emerald-50 */
    color: #047857; /* Emerald-700 */
    font-weight: 600;
    border-right: 3px solid #10B981;
}
.sidebar-nav-item.active svg { color: #047857; }

.dark .sidebar-nav-item.active {
    background-color: rgba(16, 185, 129, 0.15);
    color: #34D399; /* Emerald-400 */
    border-right: 3px solid #34D399;
}
.dark .sidebar-nav-item.active svg { color: #34D399; }

/* Force White Text for Immersive Pages */
#sidebar.force-dark-text .sidebar-nav-item,
#sidebar.force-dark-text h2, 
#sidebar.force-dark-text p,
#sidebar.force-dark-text i {
    color: rgba(255, 255, 255, 0.9) !important;
}
#sidebar.force-dark-text .sidebar-nav-item:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
}
#sidebar.force-dark-text .border-b,
#sidebar.force-dark-text .border-t {
    border-color: rgba(255, 255, 255, 0.1) !important;
}

/* Bottom Nav */
.nav-item.active { color: #10B981 !important; }
.nav-item.active svg { color: #10B981 !important; filter: drop-shadow(0 0 5px rgba(16, 185, 129, 0.3)); }
.dark .nav-item.active { color: #34D399 !important; }
.dark .nav-item.active svg { color: #34D399 !important; }

/* =========================================
   5. GLASSMORPHISM & CARDS
   ========================================= */
.glass-card {
    background: rgba(255, 255, 255, 0.85);
    border-radius: 1.25rem;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    position: relative;
    overflow: hidden;
}
.dark .glass-card {
    background: rgba(30, 41, 59, 0.70);
    border-color: rgba(255, 255, 255, 0.05);
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
}

.glass-green-card {
    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    border-radius: 1.5rem;
    color: #ECFDF5;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
}
.glass-green-card::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
    pointer-events: none;
}
.dark .glass-green-card {
    background: linear-gradient(135deg, #065F46 0%, #064E3B 100%);
    border-color: rgba(255, 255, 255, 0.1);
}

.glass-bottom-bar {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    z-index: 50;
    border-top: 1px solid rgba(0,0,0,0.05);
}
.dark .glass-bottom-bar {
    background: rgba(2, 6, 23, 0.95);
    border-top: 1px solid rgba(255,255,255,0.05);
}

.btn-eco-gradient {
    background-image: linear-gradient(135deg, #10B981, #059669);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4) !important;
    color: white;
}
.btn-eco-gradient:hover {
    background-image: linear-gradient(135deg, #34D399, #10B981);
    filter: brightness(1.05);
}

/* =========================================
   6. RESPONSIVE GRIDS & UTILITIES
   ========================================= */
@media (min-width: 768px) {
    #product-grid, #store-detail-page .grid { grid-template-columns: repeat(3, minmax(0, 1fr)) !important; }
    #dashboard .grid-cols-3 { gap: 1.5rem; }
}
@media (min-width: 1280px) {
    #product-grid, #store-detail-page .grid { grid-template-columns: repeat(4, minmax(0, 1fr)) !important; }
}
@media (min-width: 1024px) {
    #event-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
}

/* Leaderboard Elements */
.leaf {
    position: absolute;
    width: 8px; height: 8px;
    border-radius: 50%;
    background: #10B981;
    animation: leafFall linear infinite;
    opacity: 0;
}
@keyframes leafFall {
    0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(120vh) translateX(40px) rotate(360deg); opacity: 0; }
}
.leaf:nth-child(1) { left: 5%; animation-duration: 8s; animation-delay: 0s; }
.leaf:nth-child(2) { left: 20%; animation-duration: 12s; animation-delay: 2s; }
.leaf:nth-child(3) { left: 40%; animation-duration: 10s; animation-delay: 1s; }
.leaf:nth-child(4) { left: 60%; animation-duration: 14s; animation-delay: 3s; }
.leaf:nth-child(5) { left: 80%; animation-duration: 9s; animation-delay: .5s; }

/* Podium & Badge */
.podium-wrapper { position: relative; margin-bottom: 40px; padding-top: 10px; z-index: 10; }
.podium { display: flex; justify-content: center; gap: 10px; align-items: flex-end; }
.champ {
    text-align: center; padding: 15px 5px; border-radius: var(--radius); width: 32%;
    opacity: 0; animation: raise 0.8s ease forwards;
    background: linear-gradient(to bottom, #ffffff, #f1f5f9);
    box-shadow: 0 10px 25px rgba(0,0,0,0.06) !important;
    border: 1px solid #e2e8f0;
    display: flex; flex-direction: column; justify-content: flex-end;
}
.dark .champ { background: linear-gradient(to bottom, #1e293b, #0f172a); border-color: #334151; }
.champ:nth-child(1) { animation-delay: .1s; height: 140px; }
.champ:nth-child(2) { animation-delay: .2s; height: 170px; z-index: 2; border-color: #10B981; }
.champ:nth-child(3) { animation-delay: .3s; height: 130px; }
@keyframes raise { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

.badge {
    width: 50px; height: 50px; border-radius: 50%; margin: -40px auto 10px auto;
    font-weight: 700; display: flex; justify-content: center; align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important; border: 3px solid #fff;
    position: relative; overflow: hidden;
}
.gold { background: var(--gold); }
.silver { background: var(--silver); }
.bronze { background: var(--bronze); }
.badge::after {
    content: ""; position: absolute; top: -50%; left: -150%; width: 70%; height: 200%;
    background: linear-gradient(120deg, transparent, rgba(255,255,255,0.8), transparent);
    transform: skewX(-25deg); animation: shine 3.5s ease-in-out infinite;
}
@keyframes shine { 0% { left: -150%; } 50%, 100% { left: 120%; } }

.list .item {
    display: flex; justify-content: space-between; align-items: center; padding: 12px 16px;
    border-radius: var(--radius); background: #ffffff; border: 1px solid #f0f0f0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.03) !important;
}
.dark .list .item { background: #1f2937; border-color: #374151; box-shadow: none !important; }
.item.is-me { border: 2px solid #10B981; background: #ECFDF5; }
.dark .item.is-me { background: #064E3B; border-color: #10B981; }

/* =========================================
   7. MODALS & TOASTS
   ========================================= */
#checkin-modal, #chatbot-modal, #eco-quiz-modal, #purchase-modal, #qr-modal, #gallery-modal {
    transition: opacity 0.3s ease-in-out, visibility 0.3s;
}
#checkin-modal.open, #chatbot-modal.open, #eco-quiz-modal.open { opacity: 1; visibility: visible; }
#checkin-modal-content, #chatbot-modal-content, #eco-quiz-modal-content { transition: transform 0.3s ease-in-out; }
#checkin-modal.open #checkin-modal-content, #chatbot-modal.open #chatbot-modal-content { transform: translateY(0); }

/* Toast */
#app-toast {
    position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 110;
    display: flex; align-items: center; justify-content: center; gap: 12px;
    min-width: 280px; max-width: 90%; padding: 14px 20px;
    border-radius: 50px; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 14px; font-weight: 600;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); backdrop-filter: blur(8px);
    opacity: 0; animation: toastSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}
@keyframes toastSlideUp { from { transform: translate(-50%, 20px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

/* Chatbot Desktop */
@media (min-width: 1024px) {
    #chatbot-modal {
        position: fixed; top: auto; bottom: 100px; right: 40px; left: auto;
        width: 400px; height: 600px; border-radius: 20px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.15); overflow: hidden;
        transform: translateY(20px); opacity: 0; visibility: hidden;
        border: 1px solid rgba(0,0,0,0.1);
    }
    #chatbot-modal.open { transform: translateY(0); opacity: 1; visibility: visible; }
}

#app-loading { opacity: 1; visibility: visible; transition: opacity 0.5s ease-out; }
#app-loading.loaded { opacity: 0; visibility: hidden; pointer-events: none; }

.custom-select {
    -webkit-appearance: none; -moz-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-chevron-down'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em; padding-right: 2.5rem;
}
.dark .custom-select {
     background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-chevron-down'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
}

/* Santa Hat Helper (Preserved for Chatbot Icon) */
.santa-hat-overlay { position: relative; display: inline-block; }
.santa-hat-overlay::after {
    content: 'ðŸŽ…'; position: absolute; top: -15px; right: -10px;
    font-size: 1.8rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    animation: hat-bounce 3s infinite ease-in-out;
    z-index: 10; pointer-events: none;
}
@keyframes hat-bounce { 0%, 100% { transform: rotate(15deg) translateY(0); } 50% { transform: rotate(5deg) translateY(-5px); } }
